<html>
	<head>
		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">
    <script>
      window.onload = function(){
        // variable name data is set
        var data = window.geemails;


        //for loop to set data equal to the data pulled from JS and increase according to the ammount of total data (length)
        for(var i = 0; i<data.length; i++){
        	var name = data[i].sender;
        	var subject = data[i].subject;
        	var body = data[i].body;
        	var date = data[i].date;

        	//part of the for loop that sets div in page and then loads respective data into each div

            var dateInfo = document.createElement("div");
            dateInfo.className = "emailDate";
            dateInfo.innerHTML = date;
            main.appendChild(dateInfo);

        	var nameInfo = document.createElement("div");
        	nameInfo.className = "emailName";
        	nameInfo.innerHTML = name;
        	dateInfo.appendChild(nameInfo);

        	var subjectInfo = document.createElement("div");
        	subjectInfo.className = "emailSubject";
        	subjectInfo.innerHTML = subject;
        	nameInfo.appendChild(subjectInfo);

        	var bodyInfo = document.createElement("div");
        	bodyInfo.className = "emailBody";
        	bodyInfo.innerHTML = body;
        	subjectInfo.appendChild(bodyInfo);

        }

        //Counter
        var emailCount = data.length;
        document.getElementById("inbox").innerHTML = "Inbox" + " (" + emailCount + ")"

        //Retrieve new mail data 

        console.log(getNewMessage())
        
        function emailRetrieve(){
            var newData = getNewMessage()

            var nameNew = newData.sender;
            var subjectNew = newData.subject;
            var bodyNew = newData.body;
            var dateNew = newData.date;

            var dateInfoNew = document.createElement("div");
            dateInfoNew.className = "emailDate";
            dateInfoNew.innerHTML = dateNew;
            main.appendChild(dateInfoNew);

            var nameInfoNew = document.createElement("div");
            nameInfoNew.className = "emailName";
            nameInfoNew.innerHTML = nameNew;
            dateInfoNew.appendChild(nameInfoNew);

            var subjectInfoNew = document.createElement("div");
            subjectInfoNew.className = "emailSubject";
            subjectInfoNew.innerHTML = subjectNew;
            nameInfoNew.appendChild(subjectInfoNew);

            var bodyInfoNew = document.createElement("div");
            bodyInfoNew.className = "emailBody";
            bodyInfoNew.innerHTML = bodyNew;
            subjectInfoNew.appendChild(bodyInfoNew);


            //Function to display body of the email
            //Inside of the retrieve new data function to include it as well

            var parentElem = document.getElementsByClassName("emailSubject");

            for (var h = 0; h<parentElem.length; h++){
            parentElem[h].addEventListener("click", toggleBody)
            }

            function toggleBody(){
                var emailBody = this.querySelectorAll(".emailBody");
                if (emailBody.style.display === "block"){
                    emailBody.style.display = "none";
                } else{
                    emailBody.style.display = "block";
                }
            }
        }

        //Counter Update


        //Retrieve email every 30sec
        setInterval (emailRetrieve, 30000)
      };
    </script>
	</head>
	<body>
        <div>
            <img id = "emailLogo" src = "https://www.bloc.io/learn-to-code/bc/dev-league" />
            <h1 id = "emailTitle">Gee-Mail</h1>
        </div>
		<div id = "menu">
			<ul>
				<li class = "menuItem", id = "inbox">Inbox</li>
				<li class = "menuItem", id = "sent">Sent</li>
				<li class = "menuItem", id = "drafts">Drafts</li>
				<li class = "menuItem", id = "trash">Trash</li>		
			</ul>
		</div>

		<div class="container" id="main"></div>
	</body>
</html>