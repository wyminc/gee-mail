<html>
	<head>
		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">
    <script>
      window.onload = function(){


        // variable name data is set
        var data = window.geemails;


        //for loop to set data equal to the data pulled from JS and increase according to the ammount of total data (length)
        for(var i = 0; i<data.length; i++){
        	var name = data[i].sender;
        	var subject = data[i].subject;
        	var body = data[i].body;
        	var date = data[i].date;

        	//part of the for loop that sets div in page and then loads respective data into each div
            var box = document.createElement("div");
            box.id = "firstTenContainer";
            box.className = "container";
            main.appendChild(box);

            var dateInfo = document.createElement("div");
            dateInfo.id = "fistTenDate";
            dateInfo.className = "emailDate";
            dateInfo.innerHTML = date;
            box.appendChild(dateInfo);

        	var nameInfo = document.createElement("div");
            nameInfo.id = "firstTenName";
        	nameInfo.className = "emailName";
        	nameInfo.innerHTML = name;
        	dateInfo.appendChild(nameInfo);

        	var subjectInfo = document.createElement("div");
            subjectInfo.id = "firstTenSubject";
        	subjectInfo.className = "emailSubject";
        	subjectInfo.innerHTML = subject;
        	nameInfo.appendChild(subjectInfo);

        	var bodyInfo = document.createElement("div");
            bodyInfo.id = "firstTenBody"
        	bodyInfo.className = "emailBody";
        	bodyInfo.innerHTML = body;
        	subjectInfo.appendChild(bodyInfo);

        }

            //Function to display body of the email
            //Outside of the emailRetrieve function to affect the first 10 emails

            var parentElem = document.getElementsByClassName("emailSubject");

            for (var h = 0; h<parentElem.length; h++){
            parentElem[h].addEventListener("click", toggleBody);
            }

            function toggleBody(){
                var showEmail = this.querySelectorAll(".emailBody")[0];
                if (showEmail.style.display === "block"){
                    showEmail.style.display = "none";
                } else{
                    showEmail.style.display = "block";
                }
            }

        //Counter
        var emailCount = data.length;
        document.getElementById("inbox").innerHTML = "Inbox" + " (" + emailCount + ")"

        //Retrieve new mail data 

        console.log(getNewMessage())
        
        function emailRetrieve(){
            var newData = getNewMessage()

            var nameNew = newData.sender;
            var subjectNew = newData.subject;
            var bodyNew = newData.body;
            var dateNew = newData.date;

            var boxNew = document.createElement("div");
            boxNew.id = "nextContainer";
            boxNew.className = "container";
            main.appendChild(boxNew);

            var dateInfoNew = document.createElement("div");
            dateInfoNew.id = "nextDate";
            dateInfoNew.className = "emailDate";
            dateInfoNew.innerHTML = dateNew;
            boxNew.appendChild(dateInfoNew);

            var nameInfoNew = document.createElement("div");
            nameInfoNew.id = "nextName";
            nameInfoNew.className = "emailName";
            nameInfoNew.innerHTML = nameNew;
            dateInfoNew.appendChild(nameInfoNew);

            var subjectInfoNew = document.createElement("div");
            subjectInfoNew.id = "nextSubject";
            subjectInfoNew.className = "emailSubject";
            subjectInfoNew.innerHTML = subjectNew;
            nameInfoNew.appendChild(subjectInfoNew);

            var bodyInfoNew = document.createElement("div");
            bodyInfoNew.id = "nextBody";
            bodyInfoNew.className = "emailBody";
            bodyInfoNew.innerHTML = bodyNew;
            subjectInfoNew.appendChild(bodyInfoNew);

            //Changing Class Name for the first 10 email to disable toggle function (parentElem will no longer be able to grab the first 10 email cause different class)
            document.getElementById("firstTenContainer").className = "containerChanged";
            document.getElementById("fistTenDate").className = "emailDateChanged";
            document.getElementById("firstTenName").className = "emailNameChanged";
            document.getElementById("firstTenSubject").className = "emailSubjectChanged";
            document.getElementById("firstTenBody").className = "emailBodyChanged";

            //Function to display body of the email
            //Inside of the retrieve new data function to include it as well

            var parentElem = document.getElementsByClassName("emailSubject");

            for (var h = 0; h<parentElem.length; h++){
            parentElem[h].addEventListener("click", toggleBody);
            }

            function toggleBody(){
                var showEmail = this.querySelectorAll(".emailBody")[0];
                if (showEmail.style.display === "block"){
                    showEmail.style.display = "none";
                } else{
                    showEmail.style.display = "block";
                }
            }

            //Counter Update
            emailCount++
            document.getElementById("inbox").innerHTML = "Inbox" + " (" + emailCount + ")"

        }


        //Retrieve email every 30sec
        setInterval (emailRetrieve, 5000)

      };
    </script>
	</head>
	<body>
        <div>
            <img id = "emailLogo" src = "https://s3.amazonaws.com/bloc-global-assets/almanac-assets/bootcamps/logos/000/002/654/original/Dev-League.jpg?1467187318" />
            <h1 id = "emailTitle">Gee-Mail</h1>
        </div>
		<div id = "menu">
			<ul>
				<li class = "menuItem", id = "inbox">Inbox</li>
				<li class = "menuItem", id = "sent">Sent</li>
				<li class = "menuItem", id = "drafts">Drafts</li>
				<li class = "menuItem", id = "trash">Trash</li>		
			</ul>
		</div>

		<div class="container" id="main"></div>
	</body>
</html>